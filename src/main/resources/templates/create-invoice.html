<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<link rel="stylesheet" media="screen" th:href="@{/css/bootstrap.min.css}" />
		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
		<script type="text/javascript" th:src="@{/js/bootstrap.min.js}"></script>
	</head>
	<body>
		<div th:replace="fragments/header :: header">
			<!-- ============================================================================ -->
			<!-- This content is only used for static prototyping purposes (natural templates)-->
			<!-- and is therefore entirely optional, as this markup fragment will be included -->
			<!-- from "fragments/header.html" at runtime.                                     -->
			<!-- ============================================================================ -->
			<div class="navbar navbar-inverse navbar-fixed-top">
				<div class="container">
					<div class="navbar-header">
						<a class="navbar-brand" href="#">Static header</a>
					</div>
					<div class="navbar-collapse collapse">
						<ul class="nav navbar-nav">
							<li class="active"><a href="#">Home</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="page-header">
				
				<div class="row">
					<div class="col-lg-12">
						 <div class="page-header">
							<h1 id="service">Create Invoice</h1>
						</div>
					</div>
				</div>
				
				<form class="form-horizontal page-header" th:action="@{/createInvoice}" th:object="${invoiceCreateForm}" method="post">
					<fieldset>
						<div class="col-lg-12">
							<div class="form-group">
								<label for="inputInvoiceNumber" class="col-lg-3 control-label">Invoice Number</label>
								<div class="col-lg-9">
									<input class="form-control" id="inputInvoiceNumber" type="text" th:field="*{number}" placeholder="Number" />
								</div>
							</div>
						</div>
						
					</fieldset>
				
					<div class="row">
						<div class="col-lg-12">
							<div class="table-responsive">
								<table class="table table-striped table-hover">
									<thead>
										<tr>
											<th style="text-align:center;">#</th>
											<th style="text-align:center;">Service</th>
											<th style="text-align:center;">Measurement</th>
											<th style="text-align:center;">Quantity</th>
											<th style="text-align:center;">&nbsp;</th>
											<th style="text-align:center;">Price</th>
											<th style="text-align:center;">Total</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="invoiceItem,status : ${invoiceItems}" th:class="${status.odd} ? 'odd'">
											<td th:text="${status.index+1}" style="text-align:center;">Row</td>
											<td th:text="${invoiceItem.service.name}" style="text-align:center;">Service</td>
											<td th:text="${invoiceItem.service.measurement.name}" style="text-align:center;">Measurement</td>
											<td th:text="${#numbers.formatDecimal(invoiceItem.quantity, 0, 'POINT', 2, 'COMMA')}" style="text-align:center;">Quantity</td>
											<td th:text="'x'" style="text-align:center;">x</td>
											<td th:text="${#numbers.formatDecimal(invoiceItem.service.price, 0, 'POINT', 2, 'COMMA')}" style="text-align:center;">Price</td>
											<td th:text="${#numbers.formatDecimal(invoiceItem.total, 0, 'POINT', 2, 'COMMA')}" style="text-align:center;">Total</td>
										</tr>
										<tr>
											<td style="text-align:center;">&nbsp;</td>
											<td style="text-align:center;">
												<select class="form-control" id="inputService" th:field="*{serviceId}" onchange="showMeasurement()">
													<option selected="selected" value="">Choose services</option>
													<option th:each="service : ${services}" th:value="${service.id}" th:text="${service.name}">Service</option>
												</select>
											</td>
											<td style="text-align:center; vertical-align: middle;"><p id="inputMeasurement" style="margin: 0px;" /></td>
											<td style="text-align:center;"><input class="form-control" id="inputQuantity" type="text" th:field="*{quantity}" placeholder="Quantity" size="2" onkeypress="showTotal()" /></td>
											<td style="text-align:center; vertical-align: middle;">x</td>
											<td style="text-align:center; vertical-align: middle;"><p id="inputPrice" style="margin: 0px;" /></td>
											<td style="text-align:center; vertical-align: middle;"><p id="inputTotal" style="margin: 0px;" /></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</form>
			</div>
			<footer>
				<div th:replace="fragments/footer :: footer">&copy; 2017 Invoices</div>
			</footer>
		</div>

	<script th:inline="javascript">
		/*<![CDATA[*/
		function showMeasurement() {
			if ($("#inputService option:selected").index() > 0) {
				var services = /*[[${services}]]*/null;
				var selectedIndex = $("#inputService option:selected").index() - 1;
				var service = services[selectedIndex];
				$("#inputMeasurement").text(service.measurement.name);
				$("#inputPrice").text(service.price);
				console.log("selectedIndex: " + selectedIndex + ", services: " + service.measurement.name);
			}
		}
		function showTotal() {
			if ($("#inputQuantity").val() != 0 && $("#inputPrice").text() !=0) {
				var quantity = $("#inputQuantity").val();
				var price = $("#inputPrice").text();
				var total = quantity*price;
				$("#inputTotal").text(total.toFixed(2));
				console.log("quantity: " + total.toFixed(2));
			}
		}
		$(function() {
			showMeasurement();
			showTotal();
		});
		/*]]>*/
	</script>

	</body>
</html>